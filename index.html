<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dragon</title>
    <link rel="stylesheet" href="css/style.css">

    <script type="text/javascript" src="js/vendor/paper-full.js"></script>
    <script type="text/paperscript" canvas="canvas">


        var head = project.importSVG(document.getElementById('drag-head'));
        // var headSym = new Symbol(head);
        head.visible = true; // Turn off the effect of display:none;
        head.scale(0.4);
        head.rotate(0);


        var tailSegSVG = project.importSVG(document.getElementById('drag-seg'));
        tailSegSVG.visible = true;
        tailSegSVG.position = new Point(200, 200);
        tailSegSVG.scale(0.1);
        tailSegSVG.rotate(90);
        var tailSeg = new Symbol(tailSegSVG);

        mousePos = new Point(0, 0);


        var Collideable = Base.extend({
            initialize: function(position) {
                this.position = position;
                this.myCircle = new Path.Circle(new Point(this.position), 20);
                this.myCircle.fillColor = 'white';
                this.speed = [Math.random(1.0,5.0),Math.random(1.0,5.0)];
                // this.speed = [2.0, 2.0];
                this.direction = [1,1];
                this.available = true;
                this.leavingContact = false;

                this.trigger = false;
            },
            run: function() {
                this.myCircle.position = this.position;
                // this.moveAround();
            },
            move: function(position) {
                this.position = position;
            },
            moveAround: function() {
                var xPos = this.position.x;
                var yPos = this.position.y;
                var xSize = view.viewSize.width;
                var ySize = view.viewSize.height;
                this.position.x += (this.speed[0] * this.direction[0]);
                this.position.y += (this.speed[1] * this.direction[1]);
                // console.log(xSize + ", " + xPos);
                if(xPos > xSize){ this.direction[0] = -1;} else if(xPos < 10){ this.direction[0] = 1;}
                if(yPos > ySize){ this.direction[1] = -1;} else if(yPos < 10){ this.direction[1] = 1;}
                // if(this.position.x > 10){this.direction[0] * -1;}
            },
            collide: function() {

                if(this.available){
                    this.myCircle.fillColor = 'red';
                    this.sendMessage();
                    this.available = false;
                    this.leavingContact = true;
                }

            },
            collide: function(iternum) {

                if(this.available){
                    this.myCircle.fillColor = 'red';
                    this.sendMessage(iternum);
                    this.available = false;
                    this.leavingContact = true;
                }

            },
            unCollide: function() {
                 if(this.leavingContact){
                //     // this.sendMessage();
                    this.myCircle.fillColor = 'white';
                    this.available = true;
                    this.leavingContact = false;
                }


            },
            sendMessage: function() {
                console.log("hey hey hey");
                // bell.play();
                // bell.stop();
            },
            sendMessage: function(message) {
                console.log(message);
                // bell.play();
                // bell.stop();
            }


        });



        var dragSegment = Base.extend({
            initialize: function(position) {
                this.position = position;
                // this.myCircle = new Path.Circle(new Point(this.position), 20);
                this.myCircle = placedTail = tailSeg.place(0,0);

                this.speed = [Math.random(1.0,5.0),Math.random(1.0,5.0)];
                // this.speed = [2.0, 2.0];
                this.direction = [1,1];
                this.available = true;
                this.leavingContact = false;
                this.rotation = 0;

                var color1 = "#8a8";

                this.myCircle.fillColor = color1;

            },
            run: function() {
                this.myCircle.position = this.position;
                this.myCircle.rotation = this.rotation;
                // this.moveAround();
            },
            move: function(position) {
                this.position = position;
            },
            move: function(position, rotate) {
                this.position = position;
                this.rotation = rotate;
            },
            resize: function(radius) {
                this.myCircle.scale(radius);
            },
            moveAround: function() {
                var xPos = this.position.x;
                var yPos = this.position.y;
                var xSize = view.viewSize.width;
                var ySize = view.viewSize.height;
                this.position.x += (this.speed[0] * this.direction[0]);
                this.position.y += (this.speed[1] * this.direction[1]);
                if(xPos > xSize){ this.direction[0] = -1;} else if(xPos < 10){ this.direction[0] = 1;}
                if(yPos > ySize){ this.direction[1] = -1;} else if(yPos < 10){ this.direction[1] = 1;}
            },
            collide: function() {

                if(this.available){
                    this.myCircle.fillColor = 'blue';
                    this.sendMessage();
                    this.available = false;
                    this.leavingContact = true;
                }

            },
            unCollide: function() {
                 if(this.leavingContact){
                //     // this.sendMessage();
                    this.myCircle.fillColor = 'blue';
                    this.available = true;
                    this.leavingContact = false;
                }


            },
            sendMessage: function() {
                console.log("Ho Ho Ho");
            }

        });





        function moveDragon(incre, xin, yin) {

            var drgSgX = drgnSg[incre].position.x;
            var drgSgY = drgnSg[incre].position.y;

            var segLength = 20;
            var dx = xin - drgSgX;
            var dy = yin - drgSgY;
            var angle = Math.atan2(dy, dx);
            drgSgX = xin - Math.cos(angle) * segLength;
            drgSgY = yin - Math.sin(angle) * segLength;

            // console.log(angle * 180 / Math.PI);
            // var drgSgX = incre * 50;
            // var drgSgY = yin;

            // segment(tailX[iincre], tailY[incre], angle);

            drgnSg[incre].move(new Point(drgSgX, drgSgY), angle * 180 / Math.PI);

        }

        function moveDragonHead(xin, yin) {

            var drgSgX = drgnSg[0].position.x;
            var drgSgY = drgnSg[0].position.y;

            var segLength = 20;
            var dx = xin - drgSgX;
            var dy = yin - drgSgY;
            var angle = Math.atan2(dy, dx);




        }




        function onMouseMove(event) {
            // drgn.move(event.point);

            // head.position = new Point(200, 400);

            mousePos = new Point(0, 0);


            moveDragon(0, event.point.x, event.point.y);
            drgnSg[0].run();

             for (var i = 0, l = drgnSg.length-1; i < l; i++) {
                // drgnSg[i].move(event.point);
                // drgnSg[i]run();
                moveDragon(i+1, drgnSg[i].position.x, drgnSg[i].position.y);
                drgnSg[i+1].run();


             }
             moveDragonHead(event.point.x, event.point.y);
             head.position = event.point;


        }






        //--------------------- main ---------------------

        // var textNum = [];

        var cldrs = [];
        var numBalls = 3;
        for (var i = 0; i < numBalls; i++) {
            var position = Point.random() * view.size;
            cldrs.push(new Collideable(position));

            // textNum.push(new PointText(position));
        }

        var drgnSg = [];
        var numSegs = 15;
        for (var i = 0; i < numSegs; i++) {
            var position = view.center;
            drgnSg.push(new dragSegment(position));
            // project.activeLayer.insertChild(0, drgnSg[i]);
            // drgnSg[i].resize(1.0 / i);
        }



        // drgn = new dragSegment(position);

        // var text = new PointText(new Point(xPos, yPos));


        var position = Point.random() * view.size;
        // bb = new Collideable(position);

        // cldrs[0] = new Collideable(position);


        function onFrame(event) {

            // drgn.run();


            for (var i = 0, l = cldrs.length; i < l; i++) {
                cldrs[i].run();
                cldrs[i].moveAround();



                var xPos = cldrs[i].position.x;
                var yPos = cldrs[i].position.y;
                var vector1 = new Point(cldrs[i].position);
                // console.log(vector1.length);



                // textNum[i].justification = 'center';
                // textNum[i].fillColor = 'black';
                // textNum[i].position = cldrs[i].position;
                // textNum[i].content = i;




                var collideableTest = false;

                for(var j = 0; j < l; j++){

                    if (i !== j){
                        var xPos2 = cldrs[j].position.x;
                        var yPos2 = cldrs[j].position.y;

                        var vector2 = new Point(cldrs[j].position);
                        var vecLength = vector1 - vector2;
                        var vecLengthVal = Math.abs(vecLength.length);


                        if(vecLengthVal < 50){
                            // console.log("i:" + i + " j:" + j + " length:" + vecLength.length);
                            collideableTest = true;
                        }
                    }
                }

                for(var j = 0; j < drgnSg.length; j++){

                        var xPos2 = drgnSg[j].position.x;
                        var yPos2 = drgnSg[j].position.y;

                        var vector2 = new Point(drgnSg[j].position);
                        var vecLength = vector1 - vector2;
                        var vecLengthVal = Math.abs(vecLength.length);


                        if(vecLengthVal < 50){
                            collideableTest = true;
                        }

                }

                if(collideableTest){
                    cldrs[i].collide(i);
                    // cldrs[i].unCollide();
                } else {
                    cldrs[i].unCollide();
                }

            }


            // DRRAAAGGGGOONNNNN BIITTT


            // for (var i = 0, l = drgnSg.length; i < l; i++) {

            //     var xPos = drgnSg[i].position.x;
            //     var yPos = drgnSg[i].position.y;
            //     var vector1 = new Point(drgnSg[i].position);

            //     var collideableTest = false;

            //     for(var j = 0; j < cldrs.length; j++){

            //             var vector2 = new Point(cldrs[j].position);
            //             var vecLength = vector1 - vector2;
            //             var vecLengthVal = Math.abs(vecLength.length);


            //             if(vecLengthVal < 50){
            //                 cldrs[j].collide();
            //             }
            //     }


            // }

        }

        // project.activeLayer.insertChild(10, drgnSg[9]);
        project.activeLayer.insertChild(10, head);


    </script>
</head>
<body>
    <canvas id="canvas" resize></canvas>
    <svg xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         height="600" width="600" id="drag-head" style="display:none">
    <g>
        <path fill="#009BA7" d="M1011.7,441.6c-4.7-24.6-21.5-40.3-51.7-40.3s-47,15.7-51.7,40.3c-4.7,24.7-8.7,131.3-8.7,131.3H960h60.4
            C1020.4,572.9,1016.4,466.3,1011.7,441.6z"/>
        <path fill="#3A777B" d="M989.4,439.7C987,417.7,960,419,960,419s-27-1.3-29.4,20.7c-2.3,22-47.3,133.3-47.3,133.3H960h76.7
            C1036.7,573,991.7,461.7,989.4,439.7z"/>
        <circle fill="#009BA7" cx="1013" cy="506.3" r="30.7"/>
        <circle cx="1013" cy="506.3" r="23.7"/>
        <circle fill="#FFFFFF" cx="1013" cy="506.3" r="17.2"/>
        <circle fill="#2DB9DD" cx="1013" cy="506.3" r="9.9"/>
        <path fill="#3A777B" d="M982.3,506.3c0,16.9,13.7,30.7,30.7,30.7c16.9,0,30.7-13.7,30.7-30.7H982.3z"/>
        <circle fill="#009BA7" cx="907" cy="506.3" r="30.7"/>
        <circle cx="907" cy="506.3" r="23.7"/>
        <circle fill="#FFFFFF" cx="907" cy="506.3" r="17.2"/>
        <circle fill="#2DB9DD" cx="907" cy="506.3" r="9.9"/>
        <path fill="#3A777B" d="M937.7,506.3c0,16.9-13.7,30.7-30.7,30.7s-30.7-13.7-30.7-30.7H937.7z"/>
        <circle fill="#2C595C" cx="936.6" cy="434.1" r="12.4"/>
        <circle fill="#2C595C" cx="983.4" cy="434.1" r="12.4"/>
    </g>
    </svg>

    <svg xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         height="600" width="600" id="drag-seg" style="display:none">
    <g>
    <path fill="#3A777B" d="M85,343c-167,95-403.5,443.4-228.8,541.2C31,982,85,1086.9,85,1086.9S139,982,313.8,884.2
        C488.5,786.4,252,438,85,343z"/>
    <path fill="#009BA7" d="M85,424c0,0-308,290.6-168.7,368.4S85,940.1,85,940.1s29.4-69.9,168.7-147.7S85,424,85,424z"/>
</g>
    </svg>

</body>
</html>
