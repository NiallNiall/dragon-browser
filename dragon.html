<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dragon</title>
    <link rel="stylesheet" href="css/style.css">

    <script type="text/javascript" src="js/vendor/paper-full.js"></script>
    <script type="text/paperscript" canvas="canvas">


        var headSVG = project.importSVG(document.getElementById('drag-head'));
        headSVG.visible = true; // Turn off the effect of display:none;
        headSVG.position = new Point(0,0);
        headSVG.scale (0.3);
        headSVG.rotate(90);
        head = new Symbol(headSVG);
        head = head.place(0,0);


        var tailSegSVG = project.importSVG(document.getElementById('drag-seg'));
        console.log("my object: %o", tailSegSVG);
        tailSegSVG.children[0].children[1].fillColor = 'black';

        tailSegSVG.visible = true;
        tailSegSVG.position = new Point(200, 200);
        tailSegSVG.scale(0.1);
        tailSegSVG.rotate(90);
        var tailSeg = new Symbol(tailSegSVG);



        mousePos = new Point(0, 0);
        target = new Point(0,0);

        var dragSegment = Base.extend({
            initialize: function(position) {
                this.position = position;
                this.mySVG = placedTail = tailSeg.place(0,0);

                this.speed = [Math.random(1.0,5.0),Math.random(1.0,5.0)];
                this.direction = [1,1];
                this.available = true;
                this.leavingContact = false;
                this.rotation = 0;

                var color1 = "#8a8";

                this.mySVG.fillColor = color1;

            },
            run: function() {
                this.mySVG.position = this.position;
                this.mySVG.rotation = this.rotation;
                // this.moveAround();
            },
            move: function(position) {
                this.position = position;
            },
            move: function(position, rotate) {
                this.position = position;
                this.rotation = rotate;
            },
            resize: function(radius) {
                this.mySVG.scale(radius);
            },
            moveAround: function() {
                var xPos = this.position.x;
                var yPos = this.position.y;
                var xSize = view.viewSize.width;
                var ySize = view.viewSize.height;
                this.position.x += (this.speed[0] * this.direction[0]);
                this.position.y += (this.speed[1] * this.direction[1]);
                if(xPos > xSize){ this.direction[0] = -1;} else if(xPos < 10){ this.direction[0] = 1;}
                if(yPos > ySize){ this.direction[1] = -1;} else if(yPos < 10){ this.direction[1] = 1;}
            },
            collide: function() {

                if(this.available){
                    this.mySVG.fillColor = 'blue';
                    this.sendMessage();
                    this.available = false;
                    this.leavingContact = true;
                }

            },
            unCollide: function() {
                 if(this.leavingContact){
                //     // this.sendMessage();
                    this.mySVG.fillColor = 'blue';
                    this.available = true;
                    this.leavingContact = false;
                }


            },
            sendMessage: function() {
                console.log("Ho Ho Ho");
            },
            changeZIndex: function() {
                // this.myCircle.
            }

        });





        function moveDragon(incre, xin, yin) {

            var drgSgX = drgnSg[incre].position.x;
            var drgSgY = drgnSg[incre].position.y;

            var segLength = 20;
            var dx = xin - drgSgX;
            var dy = yin - drgSgY;
            var angle = Math.atan2(dy, dx);
            drgSgX = xin - Math.cos(angle) * segLength;
            drgSgY = yin - Math.sin(angle) * segLength;

            drgnSg[incre].move(new Point(drgSgX, drgSgY), angle * 180 / Math.PI);

        }


        function onMouseMove(event) {
            target = event.point;
        }


        function moveMouseBit() {
            var easing = 0.05;

            var dx = target.x - mousePos.x;
            if(Math.abs(dx) > 1) {
                mousePos.x += dx * easing;
            }

            var dy = target.y - mousePos.y;
            if(Math.abs(dy) > 1) {
                mousePos.y += dy * easing;
            }


            moveDragon(0, mousePos.x, mousePos.y);
            drgnSg[0].run();

             for (var i = 0, l = drgnSg.length-1; i < l; i++) {
                moveDragon(i+1, drgnSg[i].position.x, drgnSg[i].position.y);
                drgnSg[i+1].run();


             }

            var angle = ((Math.atan2(dy, dx) * 180) / Math.PI);

             head.position = mousePos;
             head.rotation = angle;

        }



        //--------------------- main ---------------------

        var dragonGroup = new Group();

        var drgnSg = [];
        var numSegs = 15;
        for (var i = 0; i < numSegs; i++) {
            var position = view.center;
            drgnSg.push(new dragSegment(position));
            // dragonGroup.addChild(drgnSg[i].mySVG);
            dragonGroup.addChild(drgnSg[i].mySVG);
        }
        dragonGroup.reverseChildren();
        dragonGroup.insertBelow(head);


        project.activeLayer.insertChild(100, head);

        function onFrame(event) {
            moveMouseBit();
        }



    </script>
</head>
<body>
    <canvas id="canvas" resize></canvas>
    <svg xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         height="600" width="600" id="drag-head" style="display:none">
    <g>
        <path fill="#009BA7" d="M1011.7,441.6c-4.7-24.6-21.5-40.3-51.7-40.3s-47,15.7-51.7,40.3c-4.7,24.7-8.7,131.3-8.7,131.3H960h60.4
            C1020.4,572.9,1016.4,466.3,1011.7,441.6z"/>
        <path fill="#3A777B" d="M989.4,439.7C987,417.7,960,419,960,419s-27-1.3-29.4,20.7c-2.3,22-47.3,133.3-47.3,133.3H960h76.7
            C1036.7,573,991.7,461.7,989.4,439.7z"/>
        <circle fill="#009BA7" cx="1013" cy="506.3" r="30.7"/>
        <circle cx="1013" cy="506.3" r="23.7"/>
        <circle fill="#FFFFFF" cx="1013" cy="506.3" r="17.2"/>
        <circle fill="#2DB9DD" cx="1013" cy="506.3" r="9.9"/>
        <path fill="#3A777B" d="M982.3,506.3c0,16.9,13.7,30.7,30.7,30.7c16.9,0,30.7-13.7,30.7-30.7H982.3z"/>
        <circle fill="#009BA7" cx="907" cy="506.3" r="30.7"/>
        <circle cx="907" cy="506.3" r="23.7"/>
        <circle fill="#FFFFFF" cx="907" cy="506.3" r="17.2"/>
        <circle fill="#2DB9DD" cx="907" cy="506.3" r="9.9"/>
        <path fill="#3A777B" d="M937.7,506.3c0,16.9-13.7,30.7-30.7,30.7s-30.7-13.7-30.7-30.7H937.7z"/>
        <circle fill="#2C595C" cx="936.6" cy="434.1" r="12.4"/>
        <circle fill="#2C595C" cx="983.4" cy="434.1" r="12.4"/>
    </g>
    </svg>

    <svg xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         height="600" width="600" id="drag-seg" style="display:none">
        <g>
            <path fill="#3A777B" d="M85,343c-167,95-403.5,443.4-228.8,541.2C31,982,85,1086.9,85,1086.9S139,982,313.8,884.2
                C488.5,786.4,252,438,85,343z"/>
            <path fill="#009BA7" d="M85,424c0,0-308,290.6-168.7,368.4S85,940.1,85,940.1s29.4-69.9,168.7-147.7S85,424,85,424z"/>
        </g>
    </svg>

</body>
</html>
